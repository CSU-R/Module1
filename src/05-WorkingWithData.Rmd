# Working with Data


```{block, type="caution"}
This chapter is still under construction
```

> The goal is to turn data into information, and information into insight.” – Carly Fiorina, former CEO of Hewlett-Packard

In the previous chapter, we've talked about the different types of data that R stores and the different structures that R stores data _in_.
We've mostly just made up numbers, character strings, and logical values for illustration.
In this chapter, we'll use R to do interesting things with _real data_.
This is by far the most popular use of the R programming language, and arguably the most fun!
You'll learn how to read data sets into R, do interesting things with them, and save your results.

## Quick Example

Before diving into detail, let's do a quick example so you can begin to see what is possible with data in R.
As we mentioned in the last chapter, R includes some pre-packaged data sets, which you can access with the `data()` command.
One of the data sets is `Seatbelts`, which documents road casualties in Great Britain between 1969 and 1984.
Firstly, we need to convert `Seatbelts` to a dataframe, because it starts out as a "Time-Series", which we haven't discussed.
```{r}
Seatbelts <- data.frame(as.matrix(Seatbelts), date=time(Seatbelts))   # convert Time Series to data frame
```
We've also added a month and year column 

look at the dimensions of the data set with the `dim` command:
```{r}
dim(Seatbelts)   # get the number of dimensions in the Seatbelts dataframe
```
This shows that there are 192 rows (months), and 9 columns (variables measured each month).
We could also determine the number of rows and columns separately using the `nrow` and `ncol` functions.
To view the first few rows of the Seatbelts dataframe, use the `head` command:

```{r}
head(Seatbelts)  # view first few rows of the Seatbelts dataset
```

This is a good way to learn which variables are being measured (columns) and see some example observations (rows) for each variable.
Because these data are included with R, more information about each variable can be found with:

```{r, eval=F}
?Seatbelts
```

Next, let's view a summary of each column with the summary function:

```{r}
summary(Seatbelts)
```

Since each column is numeric, R shows a five number summary (minimum, first quartile, median, third quartile, maximum) and mean for each column. 
We learn, for example, that the average number of drivers killed per month is 1670, and that the greatest price of petrol was £0.13 per litre!
Let's view a histogram of `DriversKilled`:

```{r, fig.cap="Histogram of Drivers Killed in Seatbelt data"}
hist(Seatbelts$DriversKilled, breaks=20)
```
We see that in some months, more than 150 drivers were killed!
We can calculate how many exactly like so:

```{r}
sum(Seatbelts$DriversKilled > 150)
```
To investigate the effect of the seat belt law, let's create a scatter plot Drivers killed against time:
```{r, fig.keep='all', fig.cap="UK Seatbelt deaths vs time"}
plot(Seatbelts$date, Seatbelts$DriversKilled)
```
By adding a `col` argument to the `plot` function, we can color the points based on whether the law was in effect:

```{r, fig.keep='all', fig.cap="UK Seatbelt deaths vs time, red = no seatbelt law, green = seatbelt law"}
plot(Seatbelts$date, Seatbelts$DriversKilled, col=(Seatbelts$law+2))
```

There do appear to be fewer deaths, but there is so much fluctuation in deaths each year that it's difficult to tell.

Let's change the x-axis to reflect month of the year instead of date:

```{r, fig.cap="UK Driver Deaths vs. Month"}
plot((Seatbelts$date %% 1) * 12 + 1, Seatbelts$DriversKilled, 
     xlab = "Month", col=Seatbelts$law + 2)
```
This plot shows that there is a clear seasonal effect in the number of deaths with higher deaths occurring in the Fall/Winter compared to Spring/Summer.
We can also see that within each month, the traffic deaths after enacting the Seatbelt law are among the lowest.

```{block, type="progress"}
Another data set included in R is `mtcars`. Following the example above, find the dimension of `mtcars` and have R print out a summary of each column, then create a scatter plot of fuel economy (`mpg`) to engine displacement.
What do you observe about the relationship between these two variables?
```

This concludes the quick example.
In the rest of this chapter, we'll talk in more detail about the different steps of working with data, and how to complete them using R!

```{block, type="reflect"}
People often use data in order to answer questions, but often times, learning about data can generate even _more_ questions than it answers.
Take a moment to think of a question that you have about the `Seatbelts` dataset. 
Do you think the question can be answered using the data alone?
If not, what other sources of data might be available which can help answer the question?
```

```{block, type='feedback'}
Any feedback for this section? Click [here](https://docs.google.com/forms/d/e/1FAIpQLSePQZ3lIaCIPo9J2owXImHZ_9wBEgTo21A0s-A1ty28u4yfvw/viewform?entry.1684471501=Quick%20Example)
``` 

## Reading / Writing Data

```{block, type="caution"}
This section is still under construction
```

Of course, if we want work on data which is NOT included in R, then we have to _read_ that data into R in order to work with it.
That is, the data are normally somewhere on your computer's hard drive (or SSD), and you must run a command in R which _reads_ that data into your R environment. 


### Olympic Athletes Example

Let's look another example, this time with a data set of Olympic athletes.
Here's how we'll _read_ them into R:

```{r}
# Read the csv file into a data frame called athletes
athletes <- read.csv("data_raw/olympic_athletes.csv")

# print a summary of the data frame
summary(athletes)
```

```{block2, type="caution"}
The above command only works because the data set is in a particular location (the data folder), and is in a particular format (csv). 
In the sections that follow, we'll discuss how to address both of these issues.
```

### Locating your data set

R is capable of reading data from your computer, no matter where it is, as long as you "point" R to the correct location.
The location is usually specified with a _file path_, which is a character string that specifies the folder structure that holds your file.
By default, R starts "looking" from the current working directory, and the file path used was `data_raw/olympic_athletes.csv`.
This means that R will look inside the current working directory for a folder called `data_raw`, and if it exists, R will look inside `data_raw` for a file called `olympic_athletes.csv`.
In this class, you should be working within an rstudio project, which automatically sets the working directory.
If you created the folders as instructed earlier, then you should already have a `data_raw` folder in your project directory.

```{block2, type="progress"}
Download the olympic athletes data set from [this link](data_raw/olympic_athletes.csv) and save it in your data_raw folder.
In your progress check document, simply write: "Olympic Data Downloaded"
```

### Reading CSV files

A common way of storing data in a computer file is called CSV, which stands for _comma-separated values_.
These files are _plain text_, so you can open them in any text editor like Word, Notepad, or even Google Docs.
Just like a data frame, these files contain data in rows and columns, where on each line, the columns are _separated_ from each other with a comma (`,`), which is technically called a _delimiter_.
Programs like Excel, Google Sheets, and R can read these files and understand their row-column structure.
In R, the function to read CSV files (as you saw above) is `read.csv`.
In addition, if you call up the help file for read.csv using `?`, you'll see that there are other similar functions as well, including `read.table`, and `read.delim`.

```{block, type="bonus"}
In many object oriented languages, the "dot" (`.`) is a special symbol used to access an attribute or method of an object.
In R, however,  variable names and function names can contain a dot, and the dot has no special purpose. 
There are some exceptions, however, that relate to function overloading, and R formulas, but these are advanced topics that will not be discussed here.
```

These functions are actually all different variations of the same, generic, function called `read.table`.
The difference is that `read.csv`, `read.delim`, and the others make different assumptions about what delimiters are being used, and how decimal numbers are displayed (e.g. one-and-a-half may be written as `1.5`, or `1,5` depending on where you live).
We will discuss functions and arguments more in the next chapter, but for now, see the following table for when to use each function:

```{r}
df <- data.frame(Function=c("read.table", "read.csv", "read.csv2", "read.delim", "read.delim2"), Delimiter=c("Must specify with sep=...", ",", ";", "\\t (tab)", "\\t (tab)"), Decimals=c(".", ".", ",", ".", ","))
knitr::kable(df) %>% kable_styling()
```

Any of these functions accepts the argument `header=FALSE`, which indicates that the first row of the file _does not_ contain column names.
Without this argument, R will assume the first row _does_ contain column names.
If our Olympic athletes data did not contain headers in the first row, we would use this:

```{r, eval=F}
athletes <- read.csv("data_raw/olympic_athletes.csv", header=FALSE)
```

###  Writing CSV files

R also has the capability to _write_ a dataframe to a CSV file on your computer, that could then be read by Excel, Sheets, etc.
Let's suppose we wanted to save a version of the athletes data with only the `Sex` and `Age` columns.
We could use the `write.csv` function:

```{r}
# make a new dataframe with only the Sex and Age columns
athletes2 <- athletes[,c("Sex", "Age")]

# save the new data frame as a CSV in the clean data folder
write.csv(athletes2, "data_clean/olympic_athletes_age_sex.csv")
```

Notice we created a new dataframe by selecting only the desired columns.
We will talk more about different ways to select data when we discuss _indexing_.
Notice also that the write.csv function requires that we give it the name of the dataframe being saved (`athletes2`), then the file path for the csv file that the data will be written to (`"data_clean/olympic_athletes_age_sex.csv"`).

```{block, type="caution"}
`write.csv` is an example of a function which takes _multiple arguments_. 
```

```{block, type="progress"}
Create a version of the athletes dataframe which contains the athlete's name and their sport.
Save the new dataframe as a csv file in your data_clean folder with the file name "olympic_athletes_name_sport.csv".
```




```{block, type="caution"}
The `read` and `write` terminology may seem odd if you have not heard those terms before.
Your computer's hard drive (or SSD) will store data which will be remembered even after you turn off your computer.
The process of getting data from, and putting data on your hard drive (or SSD) is called _reading_ and _writing_.
```

### Summary Statistics

Now that we've loaded 

Create some summary statistics
put those in list
save as rdata


### "Taster"(?) list of file forms and sources

### Data Format

Talk about what columns and rows mean 

(long vs. wide? probably not...)

### Reading / Writing csv

### Best practices

principles of Tidy Data (wickham 2014)

raw data as read only

```{block, type="feedback"}
Give me some [feedback](https://forms.gle/2Fw8y4aY51ijdmyE9) about the content in this section.
```

## Downloading and Saving

```{block, type="caution"}
This section is still under construction
```
```{block, type="video"}
downloading and saving example csv from canvas or website
```
```{block, type="feedback"}
Give me some [feedback](https://forms.gle/2Fw8y4aY51ijdmyE9) about the content in this section.
```

## Working With Data

Mostly Dataframes

```{block, type="caution"}
This section is still under construction
```


### Basic indexing

matrices: can use single index

nested indexing: [[1]][3]

### Advanced indexing

```{block, type="bonus"}
dplyr example
```
```{block, type="feedback"}
Give me some [feedback](https://forms.gle/2Fw8y4aY51ijdmyE9) about the content in this section.
```


### RData for non-dataframes?

### Summarizing vectors \& Matrices

Mean, std, etc.

### Basic Plotting

```{block, type="bonus"}
ggplot example
```
```{block, type="caution"}
Remember to pay close attention to the syntax when using ggplot. R won't work if parenthesis or quotes are not paired. If you're adding multiple layers, put each on a new line.

Adding structure to make your code more readable is like doing your future self a favor (and anyone reading your code).
```

## Practice

```{block, type="caution"}
This section is still under construction
```

```{block, type="progress"}
asdf
```

